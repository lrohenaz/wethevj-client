<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-ui-card/polymer-ui-card.html">
<link rel="import" href="../core-icon-button/core-icon-button.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<!--
##### Example

    <wethevj-video-item></wethevj-video-item>

@element wethevj-video-item
@blurb Element providing solution to card populated with video data.
@status [...]
@homepage https://.../wethevj-video-item
-->

<polymer-element name="wethevj-video-item" attributes="video queue vid votes">
          <template id="template">
            <style type="text/css">
            [resolved] {
              opacity: 1;
              transition: opacity 300ms;
            }
            [unresolved] {
              opacity: 0;
            /* other custom styles for unresolved elements */
            }
            .crop {
                width: 250px;
                overflow: hidden;
              	margin-right:0px;
            }
            .crop img {
                margin: -20px;
            }
            polymer-ui-card {
              display: block;
              max-width:605px;
              margin: 20px auto;
              padding: 30px;
            } 
            </style>
          <polymer-ui-card vertical layout unresolved>
            <div horizontal layout>
              <div>
                <div class="crop"><img class="ty_img" width="250" src="{{video.media$group.media$thumbnail[0].url||video.snippet.thumbnails.medium.url}}" /></div>
          	  </div>
          	  <div  style="padding-right:10px;" flex>
                <h3>{{video.title.$t||video.snippet.title}}</h3>
          	    <span>{{video.published.$t||video.snippet.publishedAt}}</span><br />
          	    <span>{{video.content.$t||video.snippet.description}}</span>
          	  </div>
            </div>
          <div horizontal layout start>
            <div style="height:100%:" vertical layout>
            RATING
            </div>
            <div horizontal end-justified layout flex>
              <div horizontal center-justified layout>
                <paper-button icon="theaters" on-click="{{togglePreviewDialog}}"></paper-button>
                <core-icon-button icon="favorite-outline"></core-icon-button>
                <paper-button icon="av:play-arrow" on-click="{{sendToQueueConfirm}}"></paper-button>
              </div>
            </div>
           <!-- /* Video Preview */ -->
            <paper-dialog heading="Preview" id="preview_{{vid}}" transition="paper-dialog-transition-center">
              <object height="350" width="425">
                <param name="movie" value="http://www.youtube.com/v/{{vid}}" />
                <embed height="350" src="http://www.youtube.com/v/{{vid}}?showinfo=no&autoplay=1&&iv_load_policy=3&fs=0&rel=0&showsearch=0&hd=1" type="application/x-shockwave-flash" width="425"></embed>
              </object>
              <paper-button label="Close" dismissive></paper-button>
            </paper-dialog>
            
            <!-- /* Queue Confirm Preview */ -->
            <paper-dialog heading="Add to Playlist" id="queueConfirm_{{vid}}" transition="paper-dialog-transition-center">
              <h1>Are you Sure?</h1>
                <paper-button label="Cancel" dismissive></paper-button>
              <paper-button label="Att to Playlist" affirmative default on-click="{{sendToQueue}}"></paper-button>
            </paper-dialog>
          </polymer-ui-card>
          
          <paper-toast id="queued_toast" text="Video added to Playlist"></paper-toast>
        </template>
  <script>
    Polymer('wethevj-video-item', {
      ready: function() {
        this.vid = this.video.id;
        this.votes=0;
        
        if(this.video.id.$t) {
          console.log("old school youtube feed detected");
          var n = this.video.id.$t.lastIndexOf('/');
          this.vid = this.video.id.$t.substring(n + 1);
        }
        if(this.video.id.videoId) {
          /* in some feeds, the id is an object containing videoId which has the actual id */
          this.vid = this.video.id.videoId;
        }
        /* loop through queue and set the vote total for this item */
        for(queue_item in this.queue) {
          if(this.vid == this.queue[queue_item].vid) {
            this.votes = this.queue[queue_item].votes;
            console.log("Votes:"+ this.votes)
          }
        }
      },
      togglePreviewDialog: function() {
        console.log("Toggle the vid");
        var previewDialog = this.shadowRoot.querySelector('#preview_'+this.vid);
        previewDialog.toggle();      
      },
      sendToQueueConfirm: function() {
        console.log("Sending to queue");
        var queueConfirmDialog = this.shadowRoot.querySelector('#queueConfirm_'+this.vid);
        queueConfirmDialog.toggle();
      },
      sendToQueue: function() {
        /* Ajax call to add video to the queue */
        console.log("send to http://wethevj.com/wethevj/rpc.php?action=addToQueue&vid="+this.vid+"&service=youtube");
        this.shadowRoot.querySelector('#queued_toast').show();
      },
      attached: function() {
        console.log("video item attached to dom");
      }
    });
  </script>

</polymer-element>
