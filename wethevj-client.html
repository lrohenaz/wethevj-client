<link rel="import" href="../core-scaffold/core-scaffold.html">
<link rel="import" href="../core-header-panel/core-header-panel.html">
<link rel="import" href="../core-menu/core-menu.html">
<link rel="import" href="../core-item/core-item.html">
<link rel="import" href="../core-icon-button/core-icon-button.html">
<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../core-icons/core-icons.html">
<link rel="import" href="../core-icon/core-icon.html">
<link rel="import" href="../core-menu/core-submenu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../core-pages/core-pages.html">
<link rel="import" href="../polymer-ui-card/polymer-ui-card.html">
<link rel="import" href="../polymer-ajax/polymer-ajax.html" />
<link rel="import" href="../core-icons/iconsets/av-icons.html" />
<link rel="import" href="../polymer-ui-ratings/polymer-ui-ratings.html" />
<link rel="import" href="../font-roboto/roboto.html" />
<link rel="import" href="../socket-connection/socket-connection.html">
<link rel="import" href="../wethevj-client/wethevj-video-item.html">
<link rel="import" href="../facebook-login/facebook-login.html">

<polymer-element name="wethevj-client" attributes="query page channel">

  <template>
    <style type="text/css">
    :host {
      font-family:'Roboto';
    }
    </style>
    <link rel="stylesheet" type="style/css" href="style.css" />
    <core-scaffold id="core_scaffold">
      <core-header-panel mode="seamed" id="core_header_panel" navigation flex>
        <core-toolbar id="core_toolbar">
          <paper-input label="Search" id="paper_input" inputvalue="{{query}}" flex></paper-input>
          <core-icon icon="search"></core-icon>
        </core-toolbar>
        <core-menu selected="{{page}}" valueattr="label" selectedindex="0" id="core_menu" theme="core-dark-theme">
          <paper-item label="PLAYLIST" icon="list" id="0" on-click="{{ menuClick }}" selected center-justified horizontal layout center active></paper-item>
          <paper-item label="EXPLORE" icon="explore" id="1" on-click="{{ menuClick }}" center horizontal layout center-justified></paper-item>
          <paper-item label="HISTORY" icon="history" id="2" on-click="{{ menuClick }}" center horizontal layout center-justified></paper-item>
          <paper-item label="FAVORITES" icon="favorite" id="3" on-click="{{ menuClick }}" center horizontal layout center-justified></paper-item>
          <paper-item label="CHATROOM" icon="account-circle" id="4" on-click="{{ menuClick }}" center horizontal layout center-justified></paper-item>
          <paper-item label="SETTINGS" icon="settings" id="5" on-click="{{ menuClick }}" center horizontal layout center-justified></paper-item>
          <paper-item label="SEARCH" icon="search" id="6" on-click="{{ menuClick }}" center horizontal layout center-justified></paper-item>
        </core-menu>
      </core-header-panel>
      <div id="div" tool><div horizontal layout flex>{{ $.core_menu.selectedItem.label }}</div></div>
      <core-pages selected="{{ $.core_menu.selectedItem.id }}" selectedindex="0" notap id="core_pages">
        <section id="playlist_page" active>
          <h1>PLAYLIST</h1>
          <polymer-ajax id="playlist_ajax" auto url="http://wethevj.com/wethevj/rpc.php" params='{"action":"get_queue", "type" : "csv", "channel":"{{channel}}"}' handleas="json" on-polymer-response="{{ playlistResponse }}">
          </polymer-ajax>
            <polymer-ajax id="playlist_yt_ajax" auto url="https://www.googleapis.com/youtube/v3/videos" params='{"id":"{{playlist_vids}}", "key":"AIzaSyCP-KyJTdtbCJOSE6CHfSH-PvJeJlFVjUc", "part":"snippet"}' handleas="json" on-polymer-response="{{ playlistYtResponse }}" unresolved>
          </polymer-ajax>
          
          <template id="template" repeat="{{video in playlist_videos.items}}">
            <wethevj-video-item video="{{video}}"></wethevj-video-item>
          </template>
        </section>
        <section id="explore_page">
          <!-- EXPLORE -->
          <polymer-ajax id="ajxp" auto url="https://www.googleapis.com/youtube/v3/search" params='{"key":"AIzaSyCP-KyJTdtbCJOSE6CHfSH-PvJeJlFVjUc", "regionCode" : "US", "videoEmbeddable" : "true", "maxResults" : "25", "order" : "rating", "type" : "video", "videoCategoryId" : "10", "part":"snippet"}' handleas="json" on-polymer-response="{{ exploreResponse }}" unresolved>
          </polymer-ajax>
          
          <template repeat="{{video in explore_videos.items}}">
            <wethevj-video-item video="{{video}}"></wethevj-video-item>
          </template>
                    
        </section>
        <section id="history_page">
          <h1>HISTORY</h1>
        </section>
        <section id="favorites_page">
          <h1>FAVORITES</h1>
          <div><facebook-login appID="776464115710177"></facebook-login></div>
        </section>
        <section id="chat_page">
          <!-- CHAT -->
          <polymer-ui-card>
          <h1>CHAT</h1>
          <span>{{ connected }}</span>

          </polymer-ui-card>
        </section>
        <section id="settings_page">
          <h1>SETTINGS</h1>
        </section>
        <section id="search_page">
          <h1>SEARCH</h1>
          <polymer-ajax id="polymer_ajax" auto url="http://gdata.youtube.com/feeds/api/videos/" params='{"alt":"json", "q":"{{$.paper_input.inputValue}}"}' handleas="json" on-polymer-response="{{ searchResponse }}">
          </polymer-ajax>
          <template id="template" repeat="{{video in search_videos.feed.entry}}">
            <wethevj-video-item video="{{video}}"></wethevj-video-item>
          </template>
        </section>
      </core-pages>
    </core-scaffold>
  </template>

  <script>

    Polymer('wethevj-client', {
      ready: function () {
          /* bind search bar to query attribute of my element */
          this.page="PLAYLIST";
          this.channel="unity88";
      },
      searchResponse: function (e,rs) {
          this.search_videos=rs.response;
          console.log(rs.response);
    	},
      exploreResponse: function (e,rs) {
          this.explore_videos=rs.response;
          console.log(rs.response);
    	},
      playlistResponse: function (e,rs) {
          this.playlist_vids=e.detail.response;
          console.log(rs);
    	},
    	playlistYtResponse: function(e,rs) {
    	    this.playlist_videos=rs.response;
          console.log(rs);
    	},
    	queryChanged: function(attr,newval,oldval) {
    	  /* not sure why but oldval is all that works, newval has a big object in it */
    	  if(newval!="") {
    	  console.log(newval);
      	  this.page="SEARCH";
    	  }
    	},
    	pageChanged: function(attr, newval, oldval) {
    	  console.log("Page changed from "+ oldval +" to "+ newval);
    	},
    	connectedChanged: function() {
    	  console.log('connected');
    	  
    	},
    	created: function() {
    	  
    	}
    });
  
  </script>

</polymer-element>